<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>wavesurfer.js – blog</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" crossorigin="anonymous">

    <link rel="stylesheet" href="/css/style.css">

    <!-- wavesurfer.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.0.52/wavesurfer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <header>
      <h1><a href="/">wavesurfer.js</a></h1>
    </header>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2">
          <ul>
            <li>
              <a href="/">Overview</a>
            </li>

            <li>
              <a href="/docs">API docs</a>
            </li>

            <li>
              <a href="/examples">Examples</a>
            </li>

            <li>
              <a href="/faq">FAQ</a>
            </li>

            <li>
              <a href="/plugins">Plugins</a>
            </li>

            <li>
              <a href="/projects">Projects</a>
            </li>

            <li>
              <a href="/blog">Blog</a>

              <ul>
                <li>
                  <a href="/blog/kindle-flashcards.html">
                    19 Feb 2016
                  </a>
                </li>
                <li class="active">
                  <a href="/blog/netflix-subs.html">
                    17 Feb 2016
                  </a>
                </li>
                <li>
                  <a href="/blog/emacs-beginning-of-function.html">
                    09 May 2015
                  </a>
                </li>
                <li>
                  <a href="/blog/js-in-webstorm-vs-emacs.html">
                    01 May 2015
                  </a>
                </li>
                <li>
                  <a href="/blog/javascript-static-analysers.html">
                    07 Mar 2015
                  </a>
                </li>
                <li>
                  <a href="/blog/restoring-nodejs-project-after-git-reset.html">
                    14 Apr 2014
                  </a>
                </li>
                <li>
                  <a href="/blog/ido-at-point.html">
                    06 Mar 2014
                  </a>
                </li>
                <li>
                  <a href="/blog/emacs-javascript.html">
                    12 Jun 2013
                  </a>
                </li>
              </ul>
            </li>
          </ul>

          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wavesurfer-jsorg" id="_carbonads_js"></script>

          <ul class="secondary-menu">
            <li>
              <a href="/about">About</a>
            </li>

            <li>
              <a href="/contact-us">Contact us</a>
            </li>

            <li>
              <a href="/privacy-policy">Privacy policy</a>
            </li>
          </ul>
        </div>

        <div class="col-sm-9 col-md-10">
          <section>
<div id="post">
  <h1>Hacking Netflix subtitles</h1>

  <h2>Why?</h2>

  <p>
    I love learning foreign languages, and consider watching movies one of the best way to do that. On the post-intermediate level especially, when you are able to actually enjoy the movie (笑). Subtitles can be a great help in the beginning (though they also may be the greatest obstacle later on). If you pair subtitles with the ability to seek to a specific phrase in the video, they become a powerful instrument.
  </p>

  <p>
    Some time ago, I built <a href="https://github.com/katspaugh/videobook">Videobook</a>. You give it a video file and a subtitles file, and it displays a navigation toolbar that lists all the subtitle phrases. You can click on a phrase and listen it over and over. It looks like this:
  </p>

  <p>
    <img width="100%" src="http://i.imgur.com/ucCcJ10.png" alt="Videobook screenshot" />
  </p>

  <p>
    Videobook works great for downloaded content, but what about streaming video (Netflix, Hulu etc)?
  </p>

  <h2>Hacking Netflix's JavaScript app</h2>

  <p>
    Netflix loads it's subtitles via XHR as a single XML file in W3C's <a href="https://en.wikipedia.org/wiki/Timed_Text_Markup_Language">TTML format</a>. After Netflix parses the file into an array of objects with start and end time + the text blocks, its React application displays the subtitles one-by-one is a div placed over the video.
  </p>

  <p>
    I was able to hi-jack the parsed subtitles array from the Netflix app by monkey-patching the <code>Array#push</code> method. You need to evaluate this code in the console as soon as the page starts loading:

<pre><code>var subs = (function () {
    var subs = [];
    var push = Array.prototype.push;
    Array.prototype.push = function () {
        if (arguments[0] && arguments[0].blocks) {
            subs[subs.length] = arguments[0];
        }
        return push.apply(this, arguments);
    };
    return subs;
}());</code></pre>

    I learned where to insert the patch by setting a break-point on DOM sub-tree modification in Chrome DevTools.
  </p>

  <p>
    <img src="http://i.imgur.com/0Ff5CdO.png" width="60%" alt="DevTools screenshot" />
  </p>

  <p>
    The subtitles are objects like this:

<pre><code>
{
  "startTime": 14000,
  "endTime": 27000,
  "blocks": [
    "textNodes": [
      "text": "Wer seid ihr?"
    ]
  ]
}
</code></pre>
  </p>

  <p>
    Next I created a simple UI to list the subs:

<pre><code>var overlay = document.createElement('div');
overlay.style.position = 'fixed';
overlay.style.zIndex = 1000;
overlay.style.right = 0;
overlay.style.top = 0;
overlay.style.bottom = 0;
overlay.style.width = '300px';
overlay.style.backgroundColor = 'white';
overlay.style.overflow = 'auto';
overlay.style.color = '#000';

var video = document.querySelector('video');

subs.forEach(function (sub) {
    var item = document.createElement('div');
    item.textContent = sub.blocks[0].textNodes.map(function (t) { return t.text; }).join('\n');
    item.style.whiteSpace = 'nowrap';
    item.style.padding = '10px 5px';

    item.onclick = function () { video.currentTime = sub.startTime / 1000 };

    overlay.appendChild(item);
});

document.body.appendChild(overlay);</code></pre>
  </p>

  <p>
    The result looks like this:
  </p>

  <p>
    <img width="100%" src="http://i.imgur.com/FHSHFSQ.jpg" alt="Netflix screenshot" />
  </p>

  <p>
    However, the Netflix app is designed in such way that when you attempt to set the position of the video via its DOM element, an error is displayed and the whole application stops.
  </p>

  <p>
    To be continued (maybe).
  </p>
</div>
          </section>
        </div>
      </div>
    </div>

    <footer>
      <div class="col-xs-12">
        <a rel="license" href="https://creativecommons.org/licenses/by/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/80x15.png" /></a>
      </div>

      <div class="col-xs-12">
        <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">wavesurfer.js</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/katspaugh/wavesurfer.js" property="cc:attributionName" rel="cc:attributionURL">katspaugh</a> is licensed under a&nbsp;<a style="white-space: nowrap" rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
      </div>

      <div class="col-xs-12 privacy">
        <h5>Privacy Policy</h5>

        <p>This site uses Google Analytics to collect anonymous data on how the site is used.</p>

        <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
        <script type="text/javascript">
            window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"dark-bottom"};
        </script>

        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
        <!-- End Cookie Consent plugin -->

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-50026819-1', 'auto');
            ga('send', 'pageview');
        </script>
      </div>
    </footer>
  </body>
</html>
