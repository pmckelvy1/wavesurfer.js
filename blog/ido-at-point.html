<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>wavesurfer.js – blog</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" crossorigin="anonymous">

    <link rel="stylesheet" href="/css/style.css">

    <!-- wavesurfer.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.0.52/wavesurfer.min.js"></script>
  </head>
  <body>
    <header>
      <h1><a href="/">wavesurfer.js</a></h1>
    </header>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2">
          <ul>
            <li>
              <a href="/">Overview</a>
            </li>

            <li>
              <a href="/docs">API docs</a>
            </li>

            <li>
              <a href="/examples">Examples</a>
            </li>

            <li>
              <a href="/faq">FAQ</a>
            </li>

            <li>
              <a href="/plugins">Plugins</a>
            </li>

            <li>
              <a href="/projects">Projects</a>
            </li>

            <li>
              <a href="/blog">Blog</a>

              <ul>
                <li>
                  <a href="/blog/netflix-subs.html">
                    17 Feb 2016
                  </a>
                </li>
                <li>
                  <a href="/blog/emacs-beginning-of-function.html">
                    09 May 2015
                  </a>
                </li>
                <li>
                  <a href="/blog/js-in-webstorm-vs-emacs.html">
                    01 May 2015
                  </a>
                </li>
                <li>
                  <a href="/blog/javascript-static-analysers.html">
                    07 Mar 2015
                  </a>
                </li>
                <li>
                  <a href="/blog/restoring-nodejs-project-after-git-reset.html">
                    14 Apr 2014
                  </a>
                </li>
                <li class="active">
                  <a href="/blog/ido-at-point.html">
                    06 Mar 2014
                  </a>
                </li>
                <li>
                  <a href="/blog/emacs-javascript.html">
                    12 Jun 2013
                  </a>
                </li>
              </ul>
            </li>
          </ul>

          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wavesurfer-jsorg" id="_carbonads_js"></script>

          <ul class="secondary-menu">
            <li>
              <a href="/about">About</a>
            </li>

            <li>
              <a href="/contact-us">Contact us</a>
            </li>

            <li>
              <a href="/privacy-policy">Privacy policy</a>
            </li>
          </ul>
        </div>

        <div class="col-sm-9 col-md-10">
          <section>
<div id="post">
    <h1 id="ido-at-point">ido-at-point</h1>

<h2 id="the-problem">The problem</h2>
<p>Built-in&nbsp;completion-at-point UI in&nbsp;Emacs is very simple. It’s usable –
especially if you don’t mind the&nbsp;popup window, necessity to&nbsp;press tab
after each letter, lack of&nbsp;support for&nbsp;asynchronous back-ends.</p>

<p>Most of&nbsp;the&nbsp;people choose alternatives like <strong>auto-complete</strong> or
<strong>company-mode</strong>. However, some people fancy <strong>ido</strong>. They prefer the&nbsp;flexible matching ido provides, and&nbsp;already use ido for&nbsp;finding files
and&nbsp;switching buffers. Maybe even for&nbsp;<code>M-x</code>-ing. If only could you
have <strong>ido</strong> complete your code, too.</p>

<p><img src="http://i.imgur.com/DMhVwF9.png" alt="ido-at-point screenshot"></p>

<h2 id="the-solution">The solution</h2>

<h3 id="standing-on-the-shoulders-of-giants">Standing on the shoulders of giants</h3>
<p><strong>Ido</strong> is modular enough to&nbsp;provide it’s prompt function
separately. It’s called <code>ido-completing-read</code>. So the&nbsp;rest seems
trivial. Just hook into&nbsp;the&nbsp;<code>completion-in-region-function</code>
variable, display <code>completion-all-completions</code> output through
<code>ido-completing-read</code> and&nbsp;insert the&nbsp;chosen candidate, right?
Suprisingly, the&nbsp;latter is the&nbsp;trickiest part.</p>

<h3 id="insert-here">Insert here</h3>
<p>The trick with&nbsp;inserting a&nbsp;completion is that candidates sometimes
come with&nbsp;the&nbsp;common part and&nbsp;sometimes not.</p>

<p>For instance, in&nbsp;<strong>elisp-mode</strong>, if you autocomplete <code>region-e</code>,
predictably, it will give you <code>region-end</code> and&nbsp;<code>region-extract-function</code>. No problem here, just remove the&nbsp;common
part, i.e. the&nbsp;original input <code>region-e</code>, and&nbsp;insert the&nbsp;candidate.</p>

<p>Now take <strong>shell-mode</strong>. Suppose, your input is <code>Sites/Do</code>. Press tab
and&nbsp;it suggests the&nbsp;following candidates: <code>Documents</code> and&nbsp;<code>Downloads</code>. See? No common part.</p>

<p>The good news is that candidates from&nbsp;<code>completion-all-completions</code>
come propertized. The common part is
<a href="https://gist.github.com/katspaugh/8262387">highlighted</a> with&nbsp;a&nbsp;special face property. Just look up&nbsp;the&nbsp;property span and&nbsp;you’ll see
if you need to&nbsp;remove anything from&nbsp;the&nbsp;input.</p>

<h3 id="async-backends-you-say">Async backends, you say?</h3>
<p>Let’s see how
<a href="http://katspaugh.github.io/2013/06/12/emacs%2Bjavascript.html#tern">Tern</a>
does that. Tern displays its completions for&nbsp;JavaScript objects
through the&nbsp;built-in&nbsp;completion-at-point. First, it hooks into&nbsp;the&nbsp;<code>completion-at-point-functions</code> variable, fetches candidates from&nbsp;a&nbsp;Node.js server, then displays them calling <code>completion-in-region</code>.</p>

<p>Subjectively, <em>every other completions backend should do the same.</em> Exploit the&nbsp;built-in&nbsp;Emacs completions system, while different completion
front-ends can just set their own <code>completion-in-region-function</code>.</p>

<h2 id="all-together--ido-at-point">All together – ido-at-point</h2>
<p>You can download <strong>ido-at-point</strong>
<a href="http://melpa.milkbox.net/#/ido-at-point">from MELPA</a>. The code is
<a href="https://github.com/katspaugh/ido-at-point">on GitHub</a> – contributions
are welcome.</p>

<h2 id="extending-ido-at-point">Extending ido-at-point</h2>
<p>By the&nbsp;way, you can override <code>ido-at-point-read</code> to&nbsp;whatever you
like. For example, if you like GUI menus,
<a href="https://gist.github.com/katspaugh/9416653">this code</a> will display
candidates in&nbsp;technicolor.</p>

<p><img src="http://i.imgur.com/6xKK2KT.png" alt="completions GUI menu"></p>

</div>
          </section>
        </div>
      </div>
    </div>

    <footer>
      <div class="col-xs-12">
        <a rel="license" href="https://creativecommons.org/licenses/by/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/80x15.png" /></a>
      </div>

      <div class="col-xs-12">
        <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">wavesurfer.js</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/katspaugh/wavesurfer.js" property="cc:attributionName" rel="cc:attributionURL">katspaugh</a> is licensed under a&nbsp;<a style="white-space: nowrap" rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
      </div>

      <div class="col-xs-12 privacy">
        <h5>Privacy Policy</h5>

        <p>This site uses Google Analytics to collect anonymous data on how the site is used.</p>

        <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
        <script type="text/javascript">
            window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"dark-bottom"};
        </script>

        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
        <!-- End Cookie Consent plugin -->

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-50026819-1', 'auto');
            ga('send', 'pageview');
        </script>
      </div>
    </footer>
  </body>
</html>
